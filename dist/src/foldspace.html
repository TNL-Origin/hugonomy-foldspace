<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VibeAI FoldSpace HUD</title>
  <style>
    /* üõ°Ô∏è Claude CSP Bypass - System Font Fallback (v2.11.2) */
    @font-face {
      font-family: "System-UI";
      src: local("Arial"), local("Helvetica"), local("sans-serif");
    }
    body {
      font-family: "System-UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }
    /* === FoldSpace Crystal Field Transparency v3.3 (Phase III-B.3) === */
    /*
     * üìä Z-INDEX HIERARCHY (Phase IV-Œî):
     * 10001 - Consent Modal Content
     * 10000 - Consent Modal Overlay
     *  9999 - Thread Inspector (interactive)
     *  9998 - Bookmark Toolbar (interactive)
     *  9997 - Trail Canvas Layer
     *  9996 - FoldSpace Canvas (Chapter Visualization)
     *  9989 - Body Vignette (non-interactive)
     */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: transparent;             /* pure transparency */
      backdrop-filter: none !important;    /* remove blur ripple */
      -webkit-backdrop-filter: none !important;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.8s ease-in forwards;
      opacity: 0;
      transition: background 0.3s ease;
      pointer-events: none;                /* allow clicks/scroll on host */
    }

    /* Optional subtle edge vignette to retain cinematic feel */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(
        circle at center,
        rgba(0, 0, 0, 0) 0%,
        rgba(0, 0, 0, 0.05) 80%,
        rgba(0, 0, 0, 0.08) 100%
      );
      z-index: 9989;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(1.05); }
      to { opacity: 1; transform: scale(1.0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; transform: scale(1.0); }
      to { opacity: 0; transform: scale(0.95); }
    }

    .fade-out {
      animation: fadeOut 0.6s ease-out forwards;
    }

    /* üé® FoldSpace Canvas Opacity (v2.11.8-BETA) */
    #foldspace-canvas {
      opacity: 0.3 !important;
    }

    .hud-container {
      text-align: center;
      color: #fff;
      font-family: 'Inter', sans-serif;
      letter-spacing: 0.05em;
      z-index: 1;
      position: relative;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .hud-container.visible {
      opacity: 1;
      visibility: visible;
    }

    .hud-buttons {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1rem;
    }

    button {
      padding: 12px 28px;
      background: linear-gradient(135deg, #007bff, #00d4ff);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0, 213, 255, 0.3);
      transition: all 0.3s ease;
    }

    button:hover {
      background: linear-gradient(135deg, #00d4ff, #007bff);
      box-shadow: 0 0 25px rgba(0, 213, 255, 0.6);
      transform: scale(1.05);
    }

    button:active {
      transform: scale(0.98);
      box-shadow: 0 0 10px rgba(0, 213, 255, 0.4);
    }

    .hud-title {
      font-size: 1.5rem;
      text-transform: uppercase;
      opacity: 0.9;
      margin-bottom: 1rem;
    }

    /* üé≠ Consent Modal Styles */
    .vibeai-modal-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.65);
      animation: fadeIn 0.8s ease-out forwards;
      z-index: 10000 !important;
      pointer-events: auto !important;
    }

    .vibeai-modal-content {
      background: rgba(24, 24, 24, 0.9);
      color: #fff;
      padding: 30px 40px;
      border-radius: 18px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0, 170, 255, 0.33);
      transform: scale(0.9);
      animation: popIn 0.6s ease-out forwards;
      pointer-events: auto !important;
      z-index: 10001 !important;
      position: relative;
    }

    .vibeai-modal-content h2 {
      margin: 0 0 15px 0;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .vibeai-modal-content p {
      margin: 0 0 25px 0;
      font-size: 1rem;
      line-height: 1.5;
      opacity: 0.9;
    }

    .vibeai-modal-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .vibeai-modal-buttons button {
      margin: 0;
      padding: 10px 22px;
      border: none;
      border-radius: 10px;
      background: #00aaff;
      color: #fff;
      cursor: pointer !important;
      pointer-events: auto !important;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .vibeai-modal-buttons button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
    }

    @keyframes popIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    /* üóÇÔ∏è Bookmark Toolbar Styles (Phase IV-Œî: explicit pointer-events) */
    #vibeai-toolbar {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20, 20, 20, 0.85);
      border-radius: 18px;
      box-shadow: 0 0 30px rgba(0, 170, 255, 0.33);
      padding: 15px 25px;
      width: 480px;
      max-height: 300px;
      color: #fff;
      overflow-y: auto;
      z-index: 9998;
      pointer-events: auto !important; /* Phase IV-Œî: explicit interactivity */
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    #vibeai-toolbar.visible {
      opacity: 1;
      visibility: visible;
    }

    #vibeai-toolbar.collapsed {
      display: none;
    }

    .vibeai-toolbar-header {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
      color: #00d4ff;
    }

    .vibeai-toolbar-actions {
      text-align: center;
      margin-top: 12px;
    }

    .vibeai-toolbar-actions button {
      margin: 6px;
      padding: 8px 18px;
      border: none;
      border-radius: 10px;
      background: #00aaff;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .vibeai-toolbar-actions button:hover {
      background: #00d4ff;
      box-shadow: 0 0 15px rgba(0, 170, 255, 0.5);
      transform: scale(1.05);
    }

    .vibeai-toolbar-list {
      max-height: 180px;
      overflow-y: auto;
      margin: 10px 0;
    }

    .vibeai-toolbar-list .bm-item {
      display: flex;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 6px 10px;
      margin: 4px 0;
      font-size: 0.9em;
      transition: background 0.2s ease;
    }

    .vibeai-toolbar-list .bm-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .vibeai-toolbar-list .bm-item span {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .vibeai-toolbar-list .bm-item time {
      margin-left: 10px;
      font-size: 0.85em;
      color: #888;
    }

    .vibeai-toolbar-list .empty {
      text-align: center;
      color: #777;
      padding: 20px;
      font-style: italic;
    }

    /* üß† Thread Inspector Styles (Phase IV-Œî: enhanced interactivity) */
    #vibeai-inspector {
      position: fixed;
      top: 50%;
      right: 30px;
      transform: translateY(-50%);
      width: 340px;
      max-height: 80vh;
      overflow-y: auto;
      background: rgba(15, 15, 20, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 0 25px rgba(0, 170, 255, 0.4);
      color: #fff;
      padding: 15px 20px;
      z-index: 9999;
      pointer-events: auto !important; /* Phase IV-Œî: explicit interactivity */
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    #vibeai-inspector.visible {
      opacity: 1;
      visibility: visible;
    }

    .vibeai-inspector-header {
      margin-bottom: 12px;
      text-align: center;
      border-bottom: 2px solid rgba(0, 170, 255, 0.3);
      padding-bottom: 12px;
    }

    .vibeai-brand {
      font-size: 1.5em;
      font-weight: bold;
      color: #00d4ff;
      letter-spacing: 2px;
      margin-bottom: 4px;
    }

    .vibeai-subtitle {
      font-size: 0.9em;
      color: rgba(0, 212, 255, 0.7);
      font-weight: normal;
    }

    .vibeai-controls {
      display: flex;
      justify-content: center;
      padding: 8px 0;
      margin-bottom: 8px;
    }

    .vibeai-controls .toggle-btn {
      background: rgba(0, 170, 255, 0.15);
      color: #00d4ff;
      border: 1px solid rgba(0, 170, 255, 0.3);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.75em;
      cursor: pointer;
      transition: all 0.2s ease;
      pointer-events: auto;
    }

    .vibeai-controls .toggle-btn:hover {
      background: rgba(0, 170, 255, 0.25);
      border-color: rgba(0, 170, 255, 0.5);
      transform: scale(1.05);
    }

    .vibeai-tone-legend {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      font-size: 0.75em;
    }

    .vibeai-tone-legend .legend-item {
      display: flex;
      align-items: center;
      color: rgba(255, 255, 255, 0.8);
    }

    .vibeai-tone-legend .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      display: inline-block;
    }

    .vibeai-tone-legend .dot.resonant {
      background: #7bff6a;
      box-shadow: 0 0 8px #7bff6a;
    }

    .vibeai-tone-legend .dot.calm {
      background: #00d4ff;
      box-shadow: 0 0 8px #00d4ff;
    }

    .vibeai-tone-legend .dot.tense {
      background: #ff4f4f;
      box-shadow: 0 0 8px #ff4f4f;
    }

    .vibeai-tone-legend .dot.drift {
      background: #ffcc00;
      box-shadow: 0 0 8px #ffcc00;
    }

    .vibeai-thread-feed {
      max-height: calc(80vh - 200px);
      overflow-y: auto;
      overflow-x: hidden;
      pointer-events: auto !important;
    }

    .vibeai-thread-feed .thread-card {
      margin: 8px 0;
      padding: 12px;
      background: rgba(255, 255, 255, 0.07);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }

    .vibeai-thread-feed .thread-card:hover {
      background: rgba(0, 170, 255, 0.15);
      border-left-color: #00aaff;
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0, 170, 255, 0.2);
    }

    .vibeai-thread-feed .thread-card .title {
      font-weight: 600;
      font-size: 0.95em;
      margin-bottom: 6px;
      color: #fff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .vibeai-thread-feed .thread-card .preview {
      font-size: 0.85em;
      opacity: 0.8;
      line-height: 1.4;
      color: #ccc;
      margin-bottom: 6px;
    }

    .vibeai-thread-feed .thread-card .meta {
      font-size: 0.75em;
      opacity: 0.6;
      color: #aaa;
      font-style: italic;
    }

    .vibeai-thread-feed .empty {
      text-align: center;
      color: #999;
      padding: 30px 20px;
      font-style: italic;
      opacity: 0.8;
      line-height: 1.8;
    }

    .vibeai-thread-feed .empty small,
    .vibeai-toolbar-list .empty small {
      display: block;
      margin-top: 8px;
      font-size: 0.85em;
      opacity: 0.6;
      color: #aaa;
      font-style: normal;
    }

    /* Scrollbar styling for thread feed */
    #vibeai-inspector::-webkit-scrollbar,
    .vibeai-thread-feed::-webkit-scrollbar {
      width: 6px;
    }

    #vibeai-inspector::-webkit-scrollbar-track,
    .vibeai-thread-feed::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    #vibeai-inspector::-webkit-scrollbar-thumb,
    .vibeai-thread-feed::-webkit-scrollbar-thumb {
      background: rgba(0, 170, 255, 0.3);
      border-radius: 10px;
    }

    #vibeai-inspector::-webkit-scrollbar-thumb:hover,
    .vibeai-thread-feed::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 170, 255, 0.5);
    }

    /* üåü Focus Glow for HUD Elements Only (Phase III-B.3) */
    .vibeai-focus-glow {
      box-shadow: 0 0 25px rgba(0, 200, 255, 0.4);
      animation: pulseGlow 4s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 25px rgba(0, 200, 255, 0.4); }
      50%      { box-shadow: 0 0 40px rgba(0, 200, 255, 0.7); }
    }

    /* ‚òÄÔ∏è Hugo Orb - Emotional Field Indicator (Phase III-C) */
    .hud-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    #hugo-orb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--orb-color, #00d4ff) 0%, transparent 70%);
      box-shadow: 0 0 15px var(--orb-color, #00d4ff);
      animation: orbPulse 3s ease-in-out infinite;
      transition: background 0.5s ease, box-shadow 0.5s ease;
    }

    @keyframes orbPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.8;
        box-shadow: 0 0 15px var(--orb-color, #00d4ff);
      }
      50% {
        transform: scale(1.3);
        opacity: 1;
        box-shadow: 0 0 25px var(--orb-color, #00d4ff);
      }
    }

    /* üåä Trail Canvas Layer (Phase III-D) */
    #vibeai-trail-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9997; /* Below HUD elements, above host page */
    }

    /* üéØ HUD Active State - Interactivity Indicator (Phase IV-C) */
    .hud-active {
      box-shadow: 0 0 12px rgba(0, 224, 255, 0.5);
      transition: box-shadow 0.2s ease, z-index 0.2s ease;
    }

    #vibeai-inspector.hud-active,
    #vibeai-toolbar.hud-active {
      outline: 1px solid rgba(0, 224, 255, 0.3);
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <!-- üìñ Emotional Chapter Journey Canvas (Phase V) -->
  <canvas id="foldspace-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9996;"></canvas>

  <!-- üåä Drift Resonance Trail Canvas -->
  <canvas id="vibeai-trail-layer"></canvas>

  <div class="hud-container">
    <div class="hud-title">
      VibeAI FoldSpace
      <div id="hugo-orb"></div>
    </div>
    <div class="hud-buttons">
      <button type="button" id="reanalyze">Re-analyze</button>
      <button type="button" id="clear">Clear</button>
    </div>
  </div>
  <script src="perf-monitor.js"></script>
  <script src="foldspace-canvas.js"></script>
  <script src="trailEngine.js"></script>
  <script src="foldspace-client.js"></script>
</body>
</html>
